<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta charset="utf-8">
  

  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://fastly.jsdelivr.net">
  <link rel="preconnect" href="https://fastly.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="//unpkg.com">

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  <title>每日一博 | Vivo 全球商城的库存系统架构设计与实践 - RSSBOX</title>

  
    <meta name="description" content="作者：vivo官网商城开发团队 - Xu Yi、Yan Chao         本文是vivo商城系列文章，主要介绍vivo商城库存系统发展历程、架构设计思路以及应对业务场景的实践。             一、业务背景     库存系统是电商商品管理的核心系统，本文主要介绍vivo商城库存中心发展历程、架构设计思路及应对各种业务场景的实践。 vivo商城原库存系统耦合在商品">
<meta property="og:type" content="article">
<meta property="og:title" content="每日一博 | Vivo 全球商城的库存系统架构设计与实践">
<meta property="og:url" content="https://kabuto0229.github.io/rss/5b62734f.html">
<meta property="og:site_name" content="RSSBOX">
<meta property="og:description" content="作者：vivo官网商城开发团队 - Xu Yi、Yan Chao         本文是vivo商城系列文章，主要介绍vivo商城库存系统发展历程、架构设计思路以及应对业务场景的实践。             一、业务背景     库存系统是电商商品管理的核心系统，本文主要介绍vivo商城库存中心发展历程、架构设计思路及应对各种业务场景的实践。 vivo商城原库存系统耦合在商品">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/53dbb3c2-dfff-4a4d-a6ef-52d145fbd166.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/bce80d3e-19e1-4398-8d3f-b39ffe497af0.png">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/3d96d810-f7f3-4634-b010-d6527c7d7e41.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/f4c3bf5f-52a5-4b35-88b4-cebedcc33a04.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/05685243-59df-46f8-b792-056240a6e5c3.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/8940420f-4816-4a02-8049-84a481b334d5.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/6e5596f9-35e2-4b2c-a92c-48f3f3cd4c78.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/936361d5-6ebc-4798-b2b9-e43523ad02fe.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/6d474ec6-fcf4-49e4-a10e-87619fda6e72.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/26fe1fd1-834b-4476-8e0a-35ba9a9fdc3c.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/94f31888-9069-4a9a-a73c-2be8d203810a.jpg">
<meta property="og:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/b634c906-a10b-4397-b8da-0439b7f96e65.jpg">
<meta property="article:published_time" content="2023-02-23T23:29:00.000Z">
<meta property="article:modified_time" content="2023-02-23T23:29:00.000Z">
<meta property="article:author" content="rss">
<meta property="article:tag" content="媒体">
<meta property="article:tag" content="开源中国">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://kabuto0229.github.io/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/53dbb3c2-dfff-4a4d-a6ef-52d145fbd166.jpg">
  
  

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/rss/css/main.css">

  

  

  

  


  
</head>

<body>
  




  <div class="l_body" id="start">
    <aside class="l_left" layout="post">
    


<header class="header">

<div class="logo-wrap"><a class="avatar" href="/rss/"><div class="bg" style="opacity:0;background-image:url(https://static.mhuig.top/gh/cdn-x/placeholder@1.0.2/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/rss/avatar.png" onerror="javascript:this.classList.add('error');this.src='rss/avatar.png';"></a><a class="title" href="/rss/"><div class="main">RSSBOX</div></a></div>
<nav class="menu dis-select"><a class="nav-item active" href="/rss/">RSS</a></nav></header>

<div class="widgets">


<div class="widget-wrap" id="recent"><div class="widget-header cap dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><div class="more-item"><a class="title" href="/rss/209bc4cb.html">Postcatlab/postcat</a></div><div class="more-item"><a class="title" href="/rss/b88dcda7.html">RadekVyM/MarvelousMAUI</a></div><div class="more-item"><a class="title" href="/rss/6085c1ff.html">TheLastBen/fast-Stable-Diffusion</a></div><div class="more-item"><a class="title" href="/rss/6fb9976.html">Anc95/writely</a></div><div class="more-item"><a class="title" href="/rss/3ce75ceb.html">Davinci1010/pinduoduo_backdoor</a></div></div></div>



</div>


    </aside>
    <div class="l_main">
      

      


<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/rss/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/rss/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/rss/categories/%E5%AA%92%E4%BD%93/">媒体</a> <span class="sep"></span> <a class="cap breadcrumb-link" href="/rss/categories/%E5%AA%92%E4%BD%93/%E5%BC%80%E6%BA%90%E4%B8%AD%E5%9B%BD/">开源中国</a></div><div id="post-meta">发布于&nbsp;<time datetime="2023-02-23T23:29:00.000Z">2023-02-24</time></div></div>

<article class="content md post">
<h1 class="article-title"><span>每日一博 | Vivo 全球商城的库存系统架构设计与实践</span></h1>
<div>
<div class="content">
<div class="rich_media_content js_underline_content autoTypeSetting24psection" id="js_content">
<section>
<mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-alias="vivoVMIC" data-from="0" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt45QXJZicZ9gaNU2mRSlvqhQd94MJ7oQh4QFj1ibPV66xnUiaKoicSatwaGXepL5sBDSDLEckicX1ttibHg/0?wx_fmt=png" data-id="MzI4NjY4MTU5Nw==" data-is_biz_ban="0" data-nickname="vivo互联网技术" data-pluginname="mpprofile" data-signature="分享 vivo 互联网技术干货与沙龙活动，推荐最新行业动态与热门会议。" data-weui-theme="light"></mp-common-profile>
</section>
<section style="font-size: 15px;line-height: 1.6;box-sizing: border-box;">
<section powered-by="xiumi.us" style="margin: 10px 0% 8px;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;vertical-align: top;border-left: 3px solid rgb(219, 219, 219);border-bottom-left-radius: 0px;padding-left: 8px;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="color: rgba(0, 0, 0, 0.5);font-size: 14px;text-align: justify;box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">作者：vivo官网商城开发团队 - Xu Yi、Yan Chao</p>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: center;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;border-width: 1px;border-style: solid;border-color: rgb(160, 160, 160);padding: 10px;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: left;box-sizing: border-box;">
<section style="text-align: justify;line-height: 1.8;padding-right: 5px;padding-left: 5px;color: rgb(160, 160, 160);box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">本文是vivo商城系列文章，主要介绍vivo商城库存系统发展历程、架构设计思路以及应对业务场景的实践。</p>
</section>
</section>
<section powered-by="xiumi.us" style="margin-right: 0%;margin-bottom: -5px;margin-left: 0%;text-align: right;line-height: 1;font-size: 5px;transform: translate3d(5px, 0px, 0px);box-sizing: border-box;">
<section style="width: 0px;display: inline-block;vertical-align: top;border-bottom: 0.6em solid rgb(160, 160, 160);border-right: 0.6em solid rgb(160, 160, 160);box-sizing: border-box;border-top: 0.6em solid transparent !important;border-left: 0.6em solid transparent !important;">
<svg style="float:left;line-height:0;width:0;vertical-align:top;" viewbox="0 0 1 1"/>
</section>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: center;box-sizing: border-box;">
<section style="padding: 3px;display: inline-block;border-bottom: 1px solid rgb(65, 94, 255);font-size: 17px;color: rgb(65, 94, 255);box-sizing: border-box;">
<p style="box-sizing: border-box;">一、业务背景</p>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">库存系统是电商商品管理的核心系统，本文主要介绍vivo商城库存中心发展历程、架构设计思路及应对各种业务场景的实践。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;">vivo商城原库存系统耦合在商品系统，考虑到相关业务逻辑复杂度越来越高，库存做了服务拆分，在可售库存管理的基础上新增了实物库存管理、秒杀库存、物流时效 、发货限制、分仓管理等功能，满足了商城库存相关业务需求。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;">本文将介绍vivo商城库存系统架构设计经验以及一些问题的解决方案。</p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: center;box-sizing: border-box;">
<section style="padding: 3px;display: inline-block;border-bottom: 1px solid rgb(65, 94, 255);font-size: 17px;color: rgb(65, 94, 255);box-sizing: border-box;">
<p style="box-sizing: border-box;">二、系统架构设计</p>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">2.1 vivo大电商库存架构</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">根据vivo大电商的销售渠道与业务场景可以将库存业务架构分为3个层级：仓库层、调度层以及销售层。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;">仓库层对应实体仓库，包括自营仓库、顺丰仓等第三方仓库以及WMS系统、ERP系统等；调度层负责库存调度与订单发货管理；销售层包含多个服务终端，vivo官方商城、vivo门店、第三方电商分销渠道等。其分层结构如图所示：</p>
<p style="white-space: normal;box-sizing: border-box;"><br></p>
<p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.47421875" data-s="300,640" data-type="jpeg" data-w="1280" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/53dbb3c2-dfff-4a4d-a6ef-52d145fbd166.jpg" style></p>
<p style="white-space: normal;box-sizing: border-box;"><br></p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">本文探讨的vivo官方商城库存架构设计，从整个vivo大电商库存架构来看，vivo官方商城库存系统涉及销售层内部架构以及销售层与调度层的交互。<br></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">2.2 商城库存系统架构演变</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">早期商城的库存冗余在各业务系统中，如可售库存在商品系统、活动库存在营销系统等，库存流转也只有扣减与释放，无法针对库存进行整合与业务创新，存在诸多限制：</p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: right;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;border-width: 1px;border-style: solid;border-color: transparent;padding: 10px;background-color: rgb(239, 239, 239);height: auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: justify;box-sizing: border-box;">
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">不能进行精细化管理，库存未分层，无法针对实物库存、分仓策略、活动库存进行精细化管理。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">没有分仓策略，无法提前获取商品收发地址，物流时效无法估算。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">无法针对地区、商品等进行发货管控。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">实时性差，无法及时同步实物库存以及分仓策略。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">性能弱，与其他系统耦合大，不能灵活扩展。</p></li>
</ul>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">基于上述限制与产品期望，21年库存系统完成初版架构设计，此后系统不断迭代完善，形成当前的系统架构：</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br></p>
<p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.8888888888888888" data-s="300,640" data-type="png" data-w="522" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/bce80d3e-19e1-4398-8d3f-b39ffe497af0.png" style></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">库存系统提供两个核心能力：交易能力和库存管理。上层业务方可以调用提供的API完成库存查询、库存扣减等操作；管理台可以按成分仓策略、库存同步等操作。</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: center;box-sizing: border-box;">
<section style="padding: 3px;display: inline-block;border-bottom: 1px solid rgb(65, 94, 255);font-size: 17px;color: rgb(65, 94, 255);box-sizing: border-box;">
<p style="box-sizing: border-box;">三、系统业务架构</p>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">3.1 库存类型&amp;分仓管理</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">3.1.1 库存类型结构</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">库存系统一共包含4类库存：可售库存、实物库存、预占库存、活动库存。</p>
<ul class="list-paddingleft-1" powered-by="xiumi.us" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">可售库存：</strong>运营配置的普通商品库存，商品维度到SKU。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">实物库存：</strong>由仓储系统同步到库存系统的实物库存，细化到具体仓库。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">预占库存：</strong>用户下单完成库存预占，仓储系统发货后释放预占库存，预占库存可以监控已下单未发货库存量。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">活动库存：</strong>用于秒杀、抢购等各类营销活动的商品库存。</p></li>
</ul>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">基于不同类型库存，可以构建一个简单的库存分层体系：</p>
<section style="font-size: 15px;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;box-sizing: border-box;">
<section style="vertical-align: middle;display: inline-block;line-height: 0;width: 80%;height: auto;border-style: solid;border-width: 0px;border-color: rgb(255, 255, 255);box-sizing: border-box;">
<img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="1.0831234256926952" data-s="300,640" data-type="jpeg" data-w="1191" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/3d96d810-f7f3-4634-b010-d6527c7d7e41.jpg" style="font-size: 15px;text-align: center;white-space: normal;">
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">3.1.2 分仓管理</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">库存中心还维护了仓库信息、分仓策略、仓库实物库存信息等等：</p>
<ul class="list-paddingleft-1" powered-by="xiumi.us" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong>仓库信息：</strong>仓库基础信息，包括仓库地址、类型、编码等。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">分仓策略：</strong>仓库功能信息，仓库可发货区域、无实物库存后的备选仓库；订单根据收货地址对应优先发货的仓库，争取尽快发货尽早到货。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">仓库库存：</strong>仓库实物库存，由仓库调度系统同步到商城库存系统。</p></li>
</ul>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">3.2 商城库存流转方案</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">商品库存流转涉及两个主要操作：正向库存扣减、逆向库存回退，整套库存变更流程如下：</p>
<p style="text-align: center;"><br></p>
<p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.68046875" data-s="300,640" data-type="jpeg" data-w="1280" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/f4c3bf5f-52a5-4b35-88b4-cebedcc33a04.jpg" style></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">3.2.1 正向库存扣减流程</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">对于库存扣减，目前常见有两种库存扣减方案：</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">（1）下单时扣库存。</strong></p>
<ul class="list-paddingleft-1" powered-by="xiumi.us" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">优点是：</strong>实时扣库存，避免付款时因库存不足而阻断影响用户体验。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">缺点是：</strong>库存有限的情况下，恶意下单占库存影响其他正常用户下单。比如说有100台手机，如果没有限制下单数量，这100个库存可能被一个用户恶意占用，导致其他用户无法购买。</p></li>
</ul>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">（2）支付时扣库存。</strong></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">优点是：</strong>不受恶意下单影响。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">缺点是：</strong>当支付订单数大于实际库存，会阻断部分用户支付，影响购物体验。比如说只有100台手机，但可能下了1000个订单，但有900个订单在支付时无法购买。</p></li>
</ul>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">从用户体验考虑，我们采用的是下单时扣库存 + 回退这种方案。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">下单时扣减库存，但只保留一段时间（比如15分钟），保留时间段内未支付则释放库存，避免长时间占用库存。</p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">3.2.2 逆向库存回退流程</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">库存回退基于库存变更日志逐个回退。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">库存回退基本流程：订单出库前用户申请退款，回退可售库存、回退预占库存、软删除扣减日志、增加回退日志；一旦商品出库，用户申请退货走处理机流程，可售库存和实物库存均不回退。</p>
<p style="white-space: normal;box-sizing: border-box;"><br></p>
<p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.1375" data-s="300,640" data-type="jpeg" data-w="1280" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/05685243-59df-46f8-b792-056240a6e5c3.jpg" style></p>
<p style="white-space: normal;box-sizing: border-box;"><br></p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">3.3 精细化发货管控</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">库存系统还提供了一系列定制辅助功能：分仓策略、发货限制、物流时效等等。</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">（1）分仓策略</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">为了给用户更快的发货，我们采用的是分仓策略，即由最近的仓库（存在优先级）给用户发货；同时存在备选仓库，当所有仓库无实物库存时可走备选仓库。</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">3.3.1 发货限制</strong></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">发货限制分地区限制时间限制。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">地区限制：</strong>根据收货地址批量设置部分区域无法发货等规则，粒度到省市区维度。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">时间限制：</strong>仓库的发货时效管理，包括每天的发货时段、大促发货时段、以及特殊情况下的停发时段。</p></li>
</ul>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">3.3.2 物流时效预估</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">根据用户收货地址，基于分仓策略确定发货地址，再基于发货时效确定发货时间，提升用户体验。</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br></p>
<p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.1375" data-s="300,640" data-type="jpeg" data-w="1280" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/8940420f-4816-4a02-8049-84a481b334d5.jpg" style></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: center;box-sizing: border-box;">
<section style="padding: 3px;display: inline-block;border-bottom: 1px solid rgb(65, 94, 255);font-size: 17px;color: rgb(65, 94, 255);box-sizing: border-box;">
<p style="box-sizing: border-box;">四、系统架构技术要点</p>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">4.1 库存扣减防重</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">订单重复提交会导致库存重复扣减，比如用户误提交、系统超时重试等，针对此类问题有如下常见解决方案：</p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: right;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;border-width: 1px;border-style: solid;border-color: transparent;padding: 10px;background-color: rgb(239, 239, 239);height: auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: justify;box-sizing: border-box;">
<ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">订单提交按钮单击置灰，避免重复提交。</p><p style="box-sizing: border-box;">注：对于按钮置灰这种方案，可以减少用户误触重复提交的可能性，但不能从根本上解决库存被重复扣减的问题，比如通过脚本来刷扣减库存的接口，依旧造成库存的重复扣减。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"> 保证库存扣减接口的幂等性。</p><p style="box-sizing: border-box;">注：保证接口幂等的方案有很多，比如每次扣减库存时，带上唯一的流水号，利用数据库的唯一索引保证幂等等。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">采用令牌机制。用户提交订单会进行令牌校验，校验通过才能提交订单。</p><p style="box-sizing: border-box;">注：这种方案保证每次提交的订单是唯一的，如果用户多次下单，那么会产生多个订单。</p></li>
</ol>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">本系统采用的是保证接口幂等性的方案。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">在库存扣减接口入参中增加订单序列号作为唯一标识，库存扣减时增加一条扣减日志。当接口重复请求时，会优先校验是否已经存在扣减记录，如果已存在则直接返回，避免重复扣减问题，具体流程如下：</p>
<section style="font-size: 15px;box-sizing: border-box;">
<section style="font-size: 15px;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;box-sizing: border-box;">
<section style="vertical-align: middle;display: inline-block;line-height: 0;width: 50%;height: auto;border-style: solid;border-width: 0px;border-color: rgb(255, 255, 255);box-sizing: border-box;">
<img class="rich_pages wxw-img lazy" data-cropselx1="0" data-cropselx2="289" data-cropsely1="0" data-cropsely2="193" data-ratio="2.37" data-type="jpeg" data-w="600" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/6e5596f9-35e2-4b2c-a92c-48f3f3cd4c78.jpg" style="vertical-align: middle;width: 289px;box-sizing: border-box;height: 685px;">
</section>
</section>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">4.2 防超卖与高并发扣减方案</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">4.2.1 常规渠道防超卖方案</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">常规下单渠道流量小且对超卖风险厌恶度极高，常用的防超卖方案有：</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin: 10px 0% 8px;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;vertical-align: top;border-left: 3px solid rgb(219, 219, 219);border-bottom-left-radius: 0px;padding-left: 8px;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="color: rgba(0, 0, 0, 0.5);text-align: justify;box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">方案一：</strong></p>
<p style="white-space: normal;box-sizing: border-box;">直接数据库扣减。通过sql判断剩余库存是否大于等于待扣库存，满足则扣减库存。该方案利用乐观锁原理即update的排他性确保事务性，避免超卖。<br style="box-sizing: border-box;"></p>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">伪代码sql：</p>
<section class="code-snippet__fix code-snippet__js">
<pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">sql：<span class="code-snippet__keyword">update</span> <span class="code-snippet__keyword">store</span> <span class="code-snippet__keyword">set</span> <span class="code-snippet__keyword">store</span> = <span class="code-snippet__keyword">store</span> - <span class="code-snippet__comment">#&#123;deductStore &#125; where (store-#&#123;deductStore &#125;) &gt;= 0</span></span></code></pre>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">该方案的<strong style="box-sizing: border-box;">优点</strong>是：</p>
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"> 实库实扣，不会出现超卖；</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">数据库乐观锁保证并发扣减一致性；</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">数据库事务保证批量扣减正常回滚。</p></li>
</ul>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">该方案的<strong style="box-sizing: border-box;">缺点</strong>是：</p>
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">行级锁的原因存在性能瓶颈，高并发会出现请求堵塞超时问题；</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">直连数据库，每次扣库存都是写操作，接口性能较低。</p></li>
</ul>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin: 10px 0% 8px;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;vertical-align: top;border-left: 3px solid rgb(219, 219, 219);border-bottom-left-radius: 0px;padding-left: 8px;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="color: rgba(0, 0, 0, 0.5);text-align: justify;box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">方案二：</strong></p>
<p style="white-space: normal;box-sizing: border-box;">利用分布式锁，强制串行化扣减同一商品库存。<br style="box-sizing: border-box;"></p>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">该方案的<strong style="box-sizing: border-box;">优点</strong>是：</p>
<p style="white-space: normal;box-sizing: border-box;">减轻数据库压力，同时还能确保不会超卖。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">该方案的<strong style="box-sizing: border-box;">缺点</strong>是：</p>
<p style="white-space: normal;box-sizing: border-box;">每次只能有一个请求抢占锁，不能应对高并发场景。</p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">对于常规渠道，库存扣减是后置逻辑，流量不高，我们采用的是直接数据库扣减，且针对弊端做了一些<strong style="box-sizing: border-box;">措施</strong>：</p>
<ul class="list-paddingleft-1" powered-by="xiumi.us" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">前置校验严格，同时针对刷单场景会有严格限流，保证最终扣减库存的流量可控；</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">库存系统读写分离，减少数据库的压力。</p></li>
</ul>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">4.2.2 高并发库存扣减方案</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">针对高并发库存扣减，比如秒杀，一般采用的是缓存扣减库存的方式（redis+lua脚本实现单线程库存更新）作为前置流程，代替数据库直接更新。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">在redis中扣减库存虽然性能高，可以大大减轻数据库压力，但需要保证缓存数据能完整、正确的入库，以保证最终一致性。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">针对缓存数据更新至数据库，目前主流方案有两种：</p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin: 10px 0% 8px;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;vertical-align: top;border-left: 3px solid rgb(219, 219, 219);border-bottom-left-radius: 0px;padding-left: 8px;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="color: rgba(0, 0, 0, 0.5);text-align: justify;box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">方案一：Redis数据直接异步更新至数据库。</strong></p>
</section>
</section>
</section>
<p style="text-align: center;"><br></p>
<section style="font-size: 15px;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;box-sizing: border-box;">
<section style="vertical-align: middle;display: inline-block;line-height: 0;width: 80%;height: auto;border-style: solid;border-width: 0px;border-color: rgb(255, 255, 255);box-sizing: border-box;">
<img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.8465909090909091" data-s="300,640" data-type="jpeg" data-w="1056" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/936361d5-6ebc-4798-b2b9-e43523ad02fe.jpg" style="font-size: 15px;text-align: center;white-space: normal;">
</section>
</section>
</section>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;"><br></p>
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">优点</strong>：简单、没有复杂的流程。</p>
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">缺陷：</strong>redis宕机或者故障，可能会造成缓存内库存数据的丢失。</p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin: 10px 0% 8px;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;vertical-align: top;border-left: 3px solid rgb(219, 219, 219);border-bottom-left-radius: 0px;padding-left: 8px;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="color: rgba(0, 0, 0, 0.5);text-align: justify;box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">方案二：Redis扣减库存时，同步在业务数据中insert库存信息。</strong></p>
</section>
</section>
</section>
<section style="font-size: 15px;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;box-sizing: border-box;">
<section style="vertical-align: middle;display: inline-block;line-height: 0;width: 50%;height: auto;border-style: solid;border-width: 0px;border-color: rgb(255, 255, 255);box-sizing: border-box;">
<img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="2.3680555555555554" data-s="300,640" data-type="jpeg" data-w="864" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/6d474ec6-fcf4-49e4-a10e-87619fda6e72.jpg" style="font-size: 15px;text-align: center;white-space: normal;">
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">这里大家可能会有两个疑问：</p>
<section powered-by="xiumi.us" style="margin: 10px 0% 8px;text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;vertical-align: top;border-left: 3px solid rgb(219, 219, 219);border-bottom-left-radius: 0px;padding-left: 8px;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="color: rgba(0, 0, 0, 0.5);text-align: justify;box-sizing: border-box;">
<ol class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><em style="box-sizing: border-box;">有数据库的插入操作，性能怎么保证？</em></p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><em style="box-sizing: border-box;">有数据库的操作，又有redis的更新，事务性怎么保证？</em></p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><em style="box-sizing: border-box;">异步更新业务库存在延迟，库存逆向回退如何保证？</em></p></li>
</ol>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">对于疑问1：</strong>由于数据库insert比update性能优，insert是在表的末尾直接插入，没有寻址的过程，可以保证性能比较快。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">对于疑问2：</strong>方案2不同于缓存直接扣减，而是把缓存扣减放在数据库insert的事务内，通过数据库的事务保证整体的事务。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;">insert的表被称为库存任务表，其中保存了库存扣减的信息，库存任务表结构可以设计的非常简单，主键 + 库存信息（json字符串）就可以了。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;">后续通过异步任务，从库存任务表表中查询出库存更新信息，将其同步到具体的库存表中，实现最终一致性，这种方案可以避免数据的丢失。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">对于疑问3：</strong>库存回退是根据业务库中扣减记录进行回退的，由于异步更新业务库必定存在延迟（延迟极低，数秒以内），所以极端场景会存在走退款逆向流程时业务库的库存扣减记录还未更新。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;">针对这种情况库存回退设置延迟重试机制，如果再极端点达到重试阈值依旧没有扣减记录，则返回回退成功，不做阻断。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">目前我们针对秒杀库存扣减，采用的是方案2。但毕竟涉及数据库的更新，为了避免风险，在前置流量校验上做了限制，保证流量的可控：</p>
<section style="font-size: 15px;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: center;margin-top: 10px;margin-bottom: 10px;line-height: 0;box-sizing: border-box;">
<section style="vertical-align: middle;display: inline-block;line-height: 0;width: 80%;height: auto;border-style: solid;border-width: 0px;border-color: rgb(255, 255, 255);box-sizing: border-box;">
<img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="1.09921875" data-s="300,640" data-type="jpeg" data-w="1280" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/26fe1fd1-834b-4476-8e0a-35ba9a9fdc3c.jpg" style="font-size: 15px;white-space: normal;text-align: center;">
</section>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">4.2.3 库存热点问题</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">什么是热点问题？热点问题就是因热点商品导致的redis、数据库等性能瓶颈。在库存系统中，<strong style="box-sizing: border-box;">热点问题主要存在</strong>：</p>
<ul class="list-paddingleft-1" powered-by="xiumi.us" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">采用<strong style="box-sizing: border-box;">直接扣减库存数据库</strong>的方式，存在数据库的行锁问题。常规渠道的库存扣减，我们采用的就是的就是这种方式。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">采用<strong style="box-sizing: border-box;">缓存扣减库存</strong>的方式，大流量的情况下，热点商品扣减库存操作会打向redis单片，造成单片性能抖动，从而出现redis性能瓶颈。</p></li>
</ul>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">对于第1种热点问题，在vivo商城常见的场景是：新发的爆品手机，在准点售卖时会有抢购效应，容易造成库存数据库单行的瓶颈问题。针对这种热点问题，我们的解决方案是“分而治之”：</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br></p>
<p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.3890625" data-s="300,640" data-type="jpeg" data-w="1280" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/94f31888-9069-4a9a-a73c-2be8d203810a.jpg" style></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">对于潜在的热点爆款手机，我们会将库存平均分为多行（比如M行），扣减库存时，随机在M行中选取一行库存数据进行扣减。该方案突破了数据库单行锁的瓶颈限制，解决了爆款商品的热点问题。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">对于第2种redis单片热点问题，解决方案也是分而治之。将数据库中的库存数据同步到redis时，把key值打散，分散在多个redis单片中。注：我们目前线上的流量峰值还达不到会造成redis单片瓶颈的问题，为避免过度设计，只做了前置限流，没有进行key值的打散。</p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><span style="font-size: 16px;color: rgb(65, 95, 255);box-sizing: border-box;">4.3 库存同步方案</span></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">库存系统存在一些库存同步场景：</p>
<ul class="list-paddingleft-1" powered-by="xiumi.us" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">对接仓储系统，完成实物库存同步。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">兼容历史架构，商品系统库存的可售库存同步等。</p></li>
</ul>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">（1）实物库存同步：</strong></p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">实物库存同步，对接的是仓储系统，通过接口来获取商品的实际库存。实物库存同步分成两种：定时全量同步、指定单品更新。</p>
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">定时全量同步：</strong>每天定时全量拉取库存调度平台的实物库存进行全量同步。</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">制定单品：</strong>运营也可以手动触发单个sku的商品即时同步实物库存。</p></li>
</ul>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">（2）商品系统库存同步：</strong></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">由于库存系统多个场景涉及库存变更，运营手动编辑、用户下单退款导致库存扣减回退，还有商品系统内编辑库存数据也会导致库存变更（以前库存系统未独立，库存数据维护在商品系统）。同时很多业务在查询库存时，参考的依旧是商品系统的库存数据。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">这里有一个问题：库存系统已经独立出来，为什么还会依赖商品系统的库存数据？</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">这有两点<strong style="box-sizing: border-box;">原因</strong>：</p>
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">商城多个业务的后台有商品筛选的需要，商品筛选会有库存数量的筛选项。商品数量很多，筛选是分页的，如果将库存数据全部替换成库存系统的，那么存在跨系统分页问题，分页筛选会存在问题；</p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;">历史遗留问题，很多业务方依赖的是商品系统的库存数据（包括依赖商品库存离线表的业务方），全部切换到库存系统，成本和影响范围大。</p></li>
</ul>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">因此，我们需要保证商品系统和库存系统两边库存数据的一致。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">库存变更场景多，为了降低业务复杂度、采用简单的方式实现库存同步，我们利用了团队自研的CDC系统（鲁班平台），整体流程如下：</p>
<p style="white-space: normal;box-sizing: border-box;"><br></p>
<p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg lazy" data-ratio="0.44375" data-s="300,640" data-type="jpeg" data-w="1280" referrerpolicy="no-referrer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://my.oschina.net&url=https://my.oschina.net/?r=https://my.oschina.net&url=https://oscimg.oschina.net/oscnet/b634c906-a10b-4397-b8da-0439b7f96e65.jpg" style></p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">库存数据库发生变更后，鲁班平台通过binlog采集获取库存变更日志，再通过自定义规则筛选，然后发送mq变更消息，最后商品系统消费消息完成库存同步变更。</p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: center;box-sizing: border-box;">
<section style="padding: 3px;display: inline-block;border-bottom: 1px solid rgb(65, 94, 255);font-size: 17px;color: rgb(65, 94, 255);box-sizing: border-box;">
<p style="box-sizing: border-box;">五、总结及展望</p>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">最后对库存系统进行一个<strong style="box-sizing: border-box;">总结</strong>：</p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;border-width: 1px;border-style: solid;border-color: transparent;padding: 10px;background-color: rgb(239, 239, 239);box-sizing: border-box;">
<section powered-by="xiumi.us" style="box-sizing: border-box;">
<p style="white-space: normal;box-sizing: border-box;">库存系统完成服务拆分，在单一的可售库存扣减功能基础上拓展了很多功能，赋能业务的发展。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">完成库存架构分层，抽象多个库存类型，更灵活地满足当前业务需求。</p>
<p style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p style="white-space: normal;box-sizing: border-box;">针对库存扣减防重、高并发场景下的库存扣减、库存热点问题、库存同步等技术问题，我们根据业务实际情况设计合理方案。</p>
</section>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br style="box-sizing: border-box;"></p>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><strong style="box-sizing: border-box;">展望</strong></p>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;box-sizing: border-box;">
<section style="display: inline-block;width: 100%;border-width: 1px;border-style: solid;border-color: transparent;padding: 10px;background-color: rgb(239, 239, 239);box-sizing: border-box;">
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;">目前vivo商城库存系统平台化能力不足，部分能力分散在其他系统中，未来我们希望能为vivo新零售提供一体化的库存管理方案。</p>
</section>
</section>
<p powered-by="xiumi.us" style="white-space: normal;box-sizing: border-box;"><br></p>
<section powered-by="xiumi.us" style="margin-right: 0%;margin-bottom: 20px;margin-left: 0%;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;">
<section style="display: inline-block;vertical-align: middle;width: 40%;align-self: center;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="margin-top: 0.5em;margin-bottom: 0.5em;box-sizing: border-box;">
<section style="border-top: 1px dotted rgb(90, 98, 114);box-sizing: border-box;">
<svg style="float:left;line-height:0;width:0;vertical-align:top;" viewbox="0 0 1 1"/>
</section>
</section>
</section>
<section style="display: inline-block;vertical-align: middle;width: 20%;align-self: center;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="text-align: center;color: rgb(45, 66, 87);font-size: 11px;box-sizing: border-box;">
<p style="box-sizing: border-box;">END</p>
</section>
</section>
<section style="display: inline-block;vertical-align: middle;width: 40%;align-self: center;flex: 0 0 auto;box-sizing: border-box;">
<section powered-by="xiumi.us" style="margin-top: 0.5em;margin-bottom: 0.5em;box-sizing: border-box;">
<section style="border-top: 1px dotted rgb(90, 98, 114);box-sizing: border-box;">
<svg style="float:left;line-height:0;width:0;vertical-align:top;" viewbox="0 0 1 1"/>
</section>
</section>
</section>
</section>
<section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;text-align: left;box-sizing: border-box;">
<section style="padding-left: 1em;padding-right: 1em;display: inline-block;text-align: center;box-sizing: border-box;">
<span opera-tn-ra-cell="_$.pages:0.layers:0.comps:154.title1" style="display: inline-block;padding: 0.3em 0.5em;border-radius: 0.5em;background-color: rgb(65, 94, 255);color: rgb(255, 255, 255);box-sizing: border-box;" title><p style="box-sizing: border-box;">猜你喜欢</p></span>
</section>
<section style="border-width: 1px;border-style: solid;border-color: transparent;margin-top: -1em;padding: 20px 10px 10px;background-color: rgb(239, 239, 239);text-align: center;box-sizing: border-box;">
<section powered-by="xiumi.us" style="font-size: 14px;text-align: left;box-sizing: border-box;">
<ul class="list-paddingleft-1" style="padding-left: 40px;list-style-position: outside;">
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><a data-itemshowtype="0" data-linktype="2" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NjY4MTU5Nw%3D%3D%26mid%3D2247494907%26idx%3D1%26sn%3D3ac53c4377a3208817ab14142427a49e%26chksm%3Debdb9c69dcac157f706a0b74522b8b928e2bebcf9c250cf1e689ffa0a4985644db2a826ac686%26scene%3D21%23wechat_redirect" imgdata="null" imgurl linktype="text" tab="innerlink" target="_blank" textvalue="vivo 全球商城：电商平台通用取货码设计" rel="external nofollow noopener noreferrer">vivo 全球商城：电商平台通用取货码设计</a></p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><a data-itemshowtype="0" data-linktype="2" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NjY4MTU5Nw%3D%3D%26mid%3D2247493253%26idx%3D2%26sn%3De82aad1dee7132e61b0553068c764857%26chksm%3Debdb9617dcac1f0130dab997e97be879b24dcd2deccafdfbdafa0684fc8a68d8e015bee5f8d4%26scene%3D21%23wechat_redirect" imgdata="null" imgurl linktype="text" tab="innerlink" target="_blank" textvalue="vivo全球商城全球化演进之路—多语言解决方案" rel="external nofollow noopener noreferrer">vivo全球商城全球化演进之路—多语言解决方案</a></p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><a data-itemshowtype="0" data-linktype="2" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NjY4MTU5Nw%3D%3D%26mid%3D2247492304%26idx%3D1%26sn%3D4f2a666cd60ce0297db5c20a763cb4b9%26chksm%3Debdb9242dcac1b54e234786ee3b2d60a873f304ee5c562410e95fbc4ef21f969c0113c7189e0%26scene%3D21%23wechat_redirect" imgdata="null" imgurl linktype="text" tab="innerlink" target="_blank" textvalue="vivo 全球商城：商品系统架构设计与实践" rel="external nofollow noopener noreferrer">vivo 全球商城：商品系统架构设计与实践</a></p></li>
<li style="box-sizing: border-box;"><p style="box-sizing: border-box;"><a data-itemshowtype="0" data-linktype="2" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NjY4MTU5Nw%3D%3D%26mid%3D2247491988%26idx%3D1%26sn%3Dd1f28063c64ce619251d3af175a9e8ed%26chksm%3Debdb9106dcac181074e664617a2f336a307636768f24f5f39d66fed25c33eaf3a3d75c209772%26scene%3D21%23wechat_redirect" imgdata="null" imgurl linktype="text" tab="innerlink" target="_blank" textvalue="vivo全球商城-营销价格监控方案的探索" rel="external nofollow noopener noreferrer">vivo全球商城-营销价格监控方案的探索</a></p></li>
</ul>
</section>
</section>
</section>
<section>
<mp-common-profile class="js_uneditable custom_select_card mp_profile_iframe" data-alias="vivoVMIC" data-from="0" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/4g5IMGibSxt45QXJZicZ9gaNU2mRSlvqhQd94MJ7oQh4QFj1ibPV66xnUiaKoicSatwaGXepL5sBDSDLEckicX1ttibHg/0?wx_fmt=png" data-id="MzI4NjY4MTU5Nw==" data-is_biz_ban="0" data-nickname="vivo互联网技术" data-pluginname="mpprofile" data-signature="分享 vivo 互联网技术干货与沙龙活动，推荐最新行业动态与热门会议。" data-weui-theme="light"></mp-common-profile>
</section>
</section>
<p style="display: none;">
<mp-style-type data-value="3"></mp-style-type></p>
</div>
<p style="color: #858585; font-size: 13px;">本文分享自微信公众号 - vivo互联网技术（vivoVMIC）。<br>如有侵权，请联系 support@oschina.cn 删除。<br>本文参与“<a href="https://www.oschina.net/sharing-plan" target="_blank" rel="external nofollow noopener noreferrer">OSC源创计划</a>”，欢迎正在阅读的你也加入，一起分享。</p>
</div>

</div>

<div>
<div class="tag-plugin link dis-select"><a class="link-card plain" title="每日一博 | vivo 全球商城的库存系统架构设计与实践" href="https://my.oschina.net/vivotech/blog/8531705" target="_blank" rel="external nofollow noopener noreferrer"><div class="left"><span class="title">每日一博 | vivo 全球商城的库存系统架构设计与实践</span><span class="desc fs12">https://my.oschina.net/vivotech/blog/8531705</span></div><div class="right"><div class="lazy img" data-bg="rss/avatar.png"></div></div></a></div>
</div>



<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>本文采用 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/me-shaon/GLWTPL/blob/master/translations/LICENSE_zh-CN">GLWT（Good Luck With That，祝你好运）公共许可证</a> 许可协议。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="header cap theme"><span>接下来阅读</span></section><section class="body fs14"><a id="next" href="/rss/c5c95235.html">IntelliJ IDEA 2023.1 Beta 2 发布，支持保存多个窗口布局<span class="note">较早</span></a><div class="line"></div><a id="prev" href="/rss/6e24a23b.html">Gitee 推荐 | 智能可视分析框架 AVA<span class="note">较新</span></a></section></div>


<div class="related-wrap reveal" id="related-posts">
    <section class="header">
      <div class="title cap theme">您可能感兴趣的文章</div>
    </section>
    <section class="body">
    <div class="related-posts"><a class="item" href="/rss/e957436c.html" title="2022年中国开源创新大赛初赛结果发布 76个项目晋级决赛"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=5135"></div><span class="title">2022年中国开源创新大赛初赛结果发布 76个项目晋级决赛</span></a><a class="item" href="/rss/79a22f83.html" title="5大GPU厂商共建 | openKylin 社区 GPU SIG 首次例会召开!"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://www.openkylin.top/upload/202303/1678413808152530.png"></div><span class="title">5大GPU厂商共建 | openKylin 社区 GPU SIG 首次例会召开!</span></a><a class="item" href="/rss/15a610d2.html" title="Audacious 4.3 发布，音频播放器"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=8617"></div><span class="title">Audacious 4.3 发布，音频播放器</span></a><a class="item" href="/rss/6e24a23b.html" title="Gitee 推荐 | 智能可视分析框架 AVA"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://gitee.com&url=https://gitee.com/?r=https://gitee.com&url=https://gw.alipayobjects.com/zos/antfincdn/R8sN%24GNdh6/language.svg"></div><span class="title">Gitee 推荐 | 智能可视分析框架 AVA</span></a><a class="item" href="/rss/c5c95235.html" title="IntelliJ IDEA 2023.1 Beta 2 发布，支持保存多个窗口布局"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://static.oschina.net/uploads/space/2023/0310/071805_rrtt_4937141.png"></div><span class="title">IntelliJ IDEA 2023.1 Beta 2 发布，支持保存多个窗口布局</span></a><a class="item" href="/rss/c4ccc6a2.html" title="JetBrains 在代码质量平台 Qodana 中引入 PHP 污点分析"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://oscimg.oschina.net/oscnet/up-19916c13c3e90ce0bc997d8f063e08b4e44.gif"></div><span class="title">JetBrains 在代码质量平台 Qodana 中引入 PHP 污点分析</span></a><a class="item" href="/rss/83144ab6.html" title="Linux 6.3 增加 Thunderbolt/USB4 DisplayPort 带宽分配模式"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://oscimg.oschina.net/oscnet/up-54df17c43edebcd2a86cd79c992a4a7eade.png"></div><span class="title">Linux 6.3 增加 Thunderbolt/USB4 DisplayPort 带宽分配模式</span></a><a class="item" href="/rss/8a315e5b.html" title="React Native 0.71.4 发布"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://picsum.photos/400/300?random=7014"></div><span class="title">React Native 0.71.4 发布</span></a><a class="item" href="/rss/2c49ce0e.html" title="Ruby 引入新 JIT 编译器 RJIT，替代 MJIT"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://static.oschina.net/uploads/space/2023/0310/082736_6VYA_2720166.png"></div><span class="title">Ruby 引入新 JIT 编译器 RJIT，替代 MJIT</span></a><a class="item" href="/rss/e4f80b8b.html" title="Wasm-Bpf —— WebAssembly eBPF 库和运行时"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://user-images.githubusercontent.com/34985212/218979864-80668806-b197-4e10-8447-6a1a21832a3f.png"></div><span class="title">Wasm-Bpf —— WebAssembly eBPF 库和运行时</span></a><a class="item" href="/rss/a56ea247.html" title="开源 Rust 时序数据库 GreptimeDB 发布 v0.1，原生支持 Python, PromQL 和对象存储"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://oscimg.oschina.net/oscnet/up-bbbadbafcdc0c3567bc2a534ff918ebdf4b.png"></div><span class="title">开源 Rust 时序数据库 GreptimeDB 发布 v0.1，原生支持 Python, PromQL 和对象存储</span></a><a class="item" href="/rss/291aab1.html" title="开源指南针 OSS Compass 顺利晋级！“2022 年中国开源创新大赛”决赛现场见"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://static.oschina.net/uploads/space/2023/0310/140007_jcG8_4489239.png"></div><span class="title">开源指南针 OSS Compass 顺利晋级！“2022 年中国开源创新大赛”决赛现场见</span></a><a class="item" href="/rss/4d53ac09.html" title="服役 8 年，Google 删除 Chrome 清理工具"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://static.oschina.net/uploads/space/2023/0310/084308_g6Ju_4937141.png"></div><span class="title">服役 8 年，Google 删除 Chrome 清理工具</span></a><a class="item" href="/rss/9832a679.html" title="程序员笔记 CherryTree 0.99.55.0 发布"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/?r=https://www.oschina.net&url=https://www.oschina.net/?r=https://www.oschina.net&url=https://oscimg.oschina.net/oscnet/up-dd36dd6b54d36c15e163c64a9d1c6c2b835.png"></div><span class="title">程序员笔记 CherryTree 0.99.55.0 发布</span></a></div></section></div>





      
<footer class="page-footer reveal fs12"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs14">RSS</span><a href="/rss/">近期</a><a href="/rss/categories/">分类</a><a href="/rss/tags/">标签</a><a href="/rss/archives/">归档</a></div></div><div class="text"><p>This is a test site.</p>
</div></footer>

      <div class="float-panel mobile-only blur" style="display:none">
  <button type="button" class="sidebar-toggle mobile" onclick="sidebar.toggle()">
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"/><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"/></svg>
  </button>
</div>

    </div>
  </div>
  <div class="scripts">
    <script type="text/javascript">
  stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.9.0';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://static.mhuig.top/npm/jquery@3.5.1/dist/jquery.min.js',
    sitesjs: '/rss/js/plugins/sites.js',
    friendsjs: '/rss/js/plugins/friends.js',
  };

  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://static.mhuig.top/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@6/swiper-bundle.min.css","js":"https://unpkg.com/swiper@6/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://static.mhuig.top/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://static.mhuig.top/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://static.mhuig.top/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://static.mhuig.top/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://static.mhuig.top/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img,article.content img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti/umd/heti.min.css","js":"https://unpkg.com/heti/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/rss/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
